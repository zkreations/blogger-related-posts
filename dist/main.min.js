!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).RelatedPosts=t()}(this,(function(){"use strict";const e={relatedSelector:"#blog-related",template:'<a class="related-item" href="{postUrl}"><div class="related-image"><img class="related-image-src" src="{featuredImage}" alt="thumbnail"></div><div class="related-title">{title}</div></a>',textOnlyTemplate:'<a class="related-item" href="{postUrl}"><div class="related-title">{title}</div></a>',defaultImage:"",directory:"summary",imageParams:"w300-h225-p-k-no-nu-rw-l80-e30",maxResults:5,observer:!0,orderby:"relevance",postId:0,rootMargin:"200px",shuffleLevel:5,summaryLength:120,tags:[],ytThumbnail:"mqdefault"};function t(e){const t=e.trim(),n={true:!0,false:!1,null:null};return t in n?n[t]:isNaN(t)?""===t?null:t:Number(t)}function n({dataset:e={}}={}){return Object.fromEntries(Object.entries(e).map((([e,n])=>[e,t(n)])))}function r(e){return e.id.$t.split(".post-")[1]}function o(e,t){return"string"==typeof e&&t.test(e)}function a(e,t){return e.media$thumbnail?.url||function(e){const t=(new DOMParser).parseFromString(e,"text/html");return t.querySelector("img")?.src||""}(t)||""}function i(e,t={}){const[n]=e.author,i=r(e),s=function(e){return e.content?.$t||e.summary?.$t||""}(e),l=e.title.$t,c=function(e){const t=document.documentElement.lang;return new Date(e).toLocaleDateString(t,{month:"long",day:"2-digit",year:"numeric"})}(e.published.$t),u=(f=s.replace(/<[^>]*>?/g,""),m=t.summaryLength,"string"!=typeof f||m<=0?"":f.length>m?`${f.slice(0,m)}...`:f);var f,m;const d=function(e){for(const t of e)if("alternate"===t.rel)return t.href}(e.link),g=function(e){return t=e,["g/blank.gif","g/b16-rounded.gif"].some((e=>t.includes(e)))?"":e;var t}(n.gd$image.src),h=function(e){return"Unknown"===e?"":e}(n.name.$t),p=function(e){return e.uri?.$t||""}(n);return{postId:i,title:l,published:c,summary:u,postUrl:d,authorImage:g,authorName:h,authorUrl:p,featuredImage:function(e,t=[]){if(0===t.length)return e;const[n,r]=t,a=/(youtube\.com\/vi\/[^/]+\/)([a-z]+)\.jpg$/,i=/(bp\.blogspot\.com\/(?:[^/]+\/){4})([\w-]+)/,s=/(googleusercontent\.com\/(?:pw\/|img\/a\/)([\w-]+))(.*)$/;return o(e,s)&&n?e.replace(s,`$1=${n}`):o(e,i)&&n?e.replace(i,`$1${n}`):o(e,a)&&r?e.replace(a,`$1${r}.jpg`):e.replace(/(googleusercontent\.com\/img\/b\/(?:[^/]+\/){2})([\w-]+)/,`$1${n}`)}(a(e,s),[t.imageParams,t.ytThumbnail])}}async function s(e){const{homeUrl:t,maxResults:n,orderby:r,shuffleLevel:o,directory:a,tags:i}=e,s=function(e){const t=e.trim().toLowerCase();return["summary","default","full"].includes(t)?t:"summary"}(a),l=function(e){return 0===e.length?"":JSON.parse(e).map((e=>`label:"${e}"`)).join("|")}(i),c=`${t}/feeds/posts/${s}?alt=json&max-results=${n+o}&orderby=${r}${l?`&q=${l}`:""}`,u=await fetch(c);return(await u.json()).feed.entry}function l(e,t){return e.replace(/{([a-zA-Z]+)}/g,((e,n)=>t[n]))}function c({config:e,entries:t,container:n}){const{template:o,textOnlyTemplate:a,shuffleLevel:s,maxResults:c,postId:u}=e;s&&(t=function(e){const t=e?e.length:0;if(!t)return[];const n=[...e];for(let e=0;e<t;e++){const r=e+Math.floor(Math.random()*(t-e));[n[e],n[r]]=[n[r],n[e]]}return n}(t=t.filter((e=>r(e)!==u))).slice(0,c));const f=(t=t.map((t=>i(t,e)))).map((e=>e.featuredImage?l(o,e):l(a,e))).join("");n.innerHTML=f,n.classList.add("related-loaded")}return class{constructor(t={}){this.currentUrl=new URL(window.location.href),this.config={...e,...t,homeUrl:this.currentUrl.origin},this.container=document.querySelector(this.config.relatedSelector)}async init(){if(!this.container)return;const e={...this.config,...n(this.container)};if(e.observer)return t=this.container,r=async()=>this.#e(e),o={rootMargin:e.rootMargin},void new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&(r(),t.unobserve(e.target))}))}),{...o}).observe(t);var t,r,o;this.#e(e)}async#e(e){const t=await s(e);t&&t.length&&c({entries:t,config:e,container:this.container})}}}));